<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; font-family: 'Pretendard', sans-serif; }
        #stage { position: relative; width: 100%; height: 100%; background: #fff; cursor: pointer; }

        /* 1. 상단 정보창 */
        #display-screen {
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            width: 92%; height: 120px; border: none; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 10px; box-sizing: border-box;
            background: rgb(245, 245, 245); z-index: 20;
            transition: background 0.2s;
        }
        #display-title { font-size: 1.1rem; font-weight: 900; color: #000; margin-bottom: 5px; text-transform: uppercase; transition: color 0.2s; }
        #display-desc { font-size: 0.8rem; color: #555; line-height: 1.4; word-break: keep-all; max-width: 450px; transition: color 0.2s; }

        /* 2. 움직이는 박스 */
        .project-box {
            position: absolute; 
            top: 150px; 
            padding: 8px 22px; border: 2px solid #000; background: #fff;
            color: #000; font-size: 0.85rem; font-weight: 800; white-space: nowrap; pointer-events: none; z-index: 5;
            transition: transform 0.1s ease-out, background 0.2s, color 0.2s;
        }

        /* 3. 캐릭터 */
        #player {
            position: absolute; 
            bottom: 340px; 
            left: 50%; transform: translateX(-50%);
            width: 65px; height: 85px; background-size: contain; background-repeat: no-repeat; background-position: center;
            z-index: 10; transition: bottom 0.25s cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        /* 4. 가이드 문구 */
        .tap-guide {
            position: absolute; 
            bottom: 285px; 
            left: 50%; transform: translateX(-50%);
            color: #bbb; text-align: center; width: 100%;
        }
        .tap-guide .en { font-size: 0.7rem; font-weight: 800; display: block; }
        .tap-guide .ko { font-size: 0.75rem; font-weight: 500; display: block; margin-top: 1px; }

        /* 5. 하단 버튼 */
        .view-all-btn {
            position: absolute; 
            bottom: 150px; 
            left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 300px; height: 48px;
            background: #000; color: #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; font-weight: 800; z-index: 100; border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            #display-screen { height: 100px; }
            .project-box { top: 130px; }
            #player { bottom: 310px; width: 55px; height: 75px; }
            .tap-guide { bottom: 260px; }
            .view-all-btn { bottom: 140px; height: 44px; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body onclick="jump()">
    <div id="stage">
        <div id="display-screen">
            <div id="display-title">JUMP TO EXPLORE</div>
            <div id="display-desc">박스를 점프하여 타격하면 상세 정보를 확인할 수 있습니다.</div>
        </div>
        <div id="player"></div>
        <div id="box-lane"></div>
        <div class="tap-guide">
            <span class="en">TAP TO JUMP</span>
            <span class="ko">캐릭터를 터치해서 점프하세요</span>
        </div>
        <div class="view-all-btn" onclick="goToProjects(event)">
            VIEW ALL PROJECTS <i class="fas fa-chevron-right" style="margin-left:10px;"></i>
        </div>
    </div>

    <script>
        const player = document.getElementById('player');
        const lane = document.getElementById('box-lane');
        const displayScreen = document.getElementById('display-screen');
        const displayTitle = document.getElementById('display-title');
        const displayDesc = document.getElementById('display-desc');

        let isJumping = false;
        const categoryData = {
            '3D MEDIA': '리얼타임/오프라인 렌더형식으로 리얼하고 아름다운 3D ART 생성합니다.',
            'AR / VR': '이미지, 좌표, 오브젝트, 공간, 인체등 인식을 바탕으로 증강현실과 체험형 가상현실을 생성합니다.',
            '2D DESIGN': '다양한 툴로 이미지 및 3D로 컨셉이미지, 공간, 상황, 광고, 제안 등 다양한 2D 작업을 제공합니다.',
            'APP': '사용자 맞춤 체험형 앱을 생성합니다.',
            'GAME': '사용자 맞춤 체험형 게임을 생성합니다.'
        };
        const projects = Object.keys(categoryData);
        const runImages = ['run_character1.png', 'run_character2.png', 'run_character3.png'];
        let boxes = [];
        let frame = 0;

        function goToProjects(e) {
            e.stopPropagation(); 
            window.parent.location.href = 'projects.html';
        }

        // 애니메이션 루프
        setInterval(() => {
            if(!isJumping) {
                player.style.backgroundImage = `url('${runImages[frame]}')`;
                frame = (frame + 1) % runImages.length;
            } else { 
                player.style.backgroundImage = `url('${runImages[1]}')`; 
            }
        }, 120);

        function initBoxes() {
            lane.innerHTML = '';
            boxes = [];
            projects.forEach((name, i) => {
                const el = document.createElement('div');
                el.className = 'project-box';
                el.innerText = name;
                let spacing = window.innerWidth > 768 ? 380 : 250;
                let x = window.innerWidth + (i * spacing);
                lane.appendChild(el);
                boxes.push({ el, x, name, hit: false });
            });
        }

        function jump() {
    if (isJumping) return;
    isJumping = true;
    
    const isMobile = window.innerWidth <= 768;
    const baseBottom = isMobile ? 310 : 340;
    
    // [수정] 화면 높이에 따라 점프 높이를 유동적으로 결정
    // PC에서는 화면이 넓으므로 점프를 조금 낮게(90px), 모바일에서는 좁으므로 적당하게(120px)
    let jumpHeight = isMobile ? 120 : 90;

    // 만약 PC에서도 창 높이가 너무 낮다면 더 낮게 조정 (안전장치)
    if (window.innerHeight < 700) {
        jumpHeight = isMobile ? 110 : 70;
    }

    player.style.bottom = (baseBottom + jumpHeight) + 'px'; 

    setTimeout(() => {
        player.style.bottom = baseBottom + 'px';
        setTimeout(() => { 
            isJumping = false; 
            boxes.forEach(b => b.hit = false);
        }, 150);
    }, 250);
}

        function performHit(box) {
            box.hit = true;
            displayTitle.innerText = box.name;
            displayDesc.innerText = categoryData[box.name];
            
            // 타격 효과
            box.el.style.transform = 'translateY(-20px) scale(1.05)';
            box.el.style.background = '#000';
            box.el.style.color = '#fff';
            displayScreen.style.background = "#000";
            displayTitle.style.color = "#fff";
            displayDesc.style.color = "#ccc";

            setTimeout(() => {
                box.el.style.transform = 'translateY(0) scale(1)';
                box.el.style.background = '#fff';
                box.el.style.color = '#000';
                displayScreen.style.background = "rgb(245, 245, 245)";
                displayTitle.style.color = "#000";
                displayDesc.style.color = "#555";
            }, 200);
        }

        function update() {
            const pRect = player.getBoundingClientRect();
            
            boxes.forEach(box => {
                // 1. 박스 이동 로직
                box.x -= (window.innerWidth > 768 ? 5 : 4);
                if (box.x < -350) {
                    let rightmostX = Math.max(...boxes.map(b => b.x));
                    let spacing = window.innerWidth > 768 ? 380 : 250;
                    box.x = rightmostX + spacing;
                }
                box.el.style.left = box.x + 'px';

                // 2. 실시간 물리 판정 로직
                const bRect = box.el.getBoundingClientRect();

                // 가로 범위 판정: 캐릭터 좌우 폭이 박스 범위 내에 있는지
                const isWithinX = pRect.left < bRect.right - 15 && pRect.right > bRect.left + 15;
                // 세로 범위 판정: 캐릭터 머리(top)가 박스 하단(bottom)보다 높이(수치상 작게) 올라갔는지
                // +30px의 여유를 주어 인앱 브라우저 오차 완벽 대응
                const isWithinY = pRect.top <= bRect.bottom + 30;

                if (isJumping && !box.hit && isWithinX && isWithinY) {
                    performHit(box);
                }
            });
            requestAnimationFrame(update);
        }

        window.addEventListener('resize', initBoxes);
        initBoxes();
        update();
    </script>
</body>
</html>

